<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avatar Demo</title>
  <link href="./css/styles.css" rel="stylesheet">
  <link href="./css/theme-system.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
    <script src="https://aka.ms/csspeech/jsbrowserpackageraw"></script>
    <script src="./js/theme-manager.js"></script>
    <script src="./js/config.js"></script>
    <script src="./js/chat.js"></script>
</head>
<body class="bg-light pt-navbar">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center" href="#"><i class="bi bi-robot me-2"></i>Azure AI Speech Avatar</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item"><a class="nav-link active" aria-current="page" href="#"><i class="bi bi-chat-dots me-1"></i>Chat</a></li>
        <li class="nav-item"><a class="nav-link" href="config.html"><i class="bi bi-gear me-1"></i>Configuration</a></li>
      </ul>
      <div class="sponsor-logos-nav ms-auto d-flex align-items-center gap-3">
        <button id="themeToggle" class="btn btn-sm" onclick="toggleTheme()" title="Cycle theme: Auto → Light → Dark">
          <i id="themeIcon" class="bi bi-circle-half"></i>
          <span id="themeText">Auto</span>
        </button>
        <img src="./image/lima-transparent-cropped.png" alt="AgentCon Lima" class="sponsor-logo" />
        <img src="./image/globalai_logo.svg" alt="Global AI" class="sponsor-logo" />
      </div>
    </div>
  </div>
</nav>

<main class="container mt-3">

<div class="d-flex flex-wrap gap-2 mb-3">
  <button id="startSession" class="btn btn-primary" onclick="startAvatarSession()"><i class="bi bi-play-circle me-1"></i>Open Avatar Session</button>
  <button id="microphone" class="btn btn-secondary" onclick="window.microphone()" disabled title="Alt+M"><i class="bi bi-mic me-1"></i>Start Microphone</button>
  <button id="stopSpeaking" class="btn btn-outline-secondary" onclick="stopSpeaking()" disabled title="Alt+S"><i class="bi bi-stop-fill me-1"></i>Stop Speaking</button>
  <button id="clearChatHistory" class="btn btn-outline-danger" onclick="window.clearChatHistory()"><i class="bi bi-trash me-1"></i>Clear Chat History</button>
  <button id="stopSession" class="btn btn-outline-primary" onclick="window.stopSession()" disabled><i class="bi bi-x-circle me-1"></i>Close Avatar Session</button>
  <button id="debugAvatar" class="btn btn-warning" onclick="debugAvatarConnection()"><i class="bi bi-tools me-1"></i>Debug Avatar</button>
  </div>

<div class="row g-3">
  <!-- Left: Avatar / Video -->
  <div class="col-12 col-lg-8">
  <div id="videoContainer" class="video-panel video-container">
      <div id="remoteVideo"></div>
  <div id="subtitles" class="subtitles" hidden></div>
    </div>
    <!-- Mic overlay: below the video -->
    <div id="micOverlay" class="mic-overlay" hidden>
      <div class="mic-overlay-card" id="micOverlayCard">
        <button id="micOverlayBtn" class="mic-btn" type="button" title="Alt+M">
          <i class="bi bi-mic-fill"></i>
        </button>
        <div id="micOverlayLabel" class="mic-overlay-label">Press the mic to start talking</div>
      </div>
    </div>
  </div>

  <!-- Right: Conversation -->
  <div class="col-12 col-lg-4">
    <div class="chat-card p-2">
      <div class="d-flex align-items-center justify-content-between mb-2">
        <h2 class="h6 m-0">Conversation</h2>
      </div>
      <div class="mb-2" id="suggestedQuestions">
        <button id="suggestBtn1" class="btn btn-sm btn-outline-secondary me-1">hola quien eres</button>
        <button id="suggestBtn2" class="btn btn-sm btn-outline-secondary">ola sabes si va a haber una sesion de Copilot Studio en AgentCon Lima?</button>
      </div>
  <div id="chatHistory" class="form-control chat-history" hidden></div>
      <div class="mt-2">
        <div id="showTypeMessageCheckbox" class="form-check">
          <input type="checkbox" id="showTypeMessage" class="form-check-input" onchange="window.updateTypeMessageBox()" disabled>
          <label for="showTypeMessage" class="form-check-label">Type Message</label>
        </div>
        <div id="typeMessageContainer" class="input-group mt-1" hidden>
          <input id="userMessageInput" type="text" class="form-control" placeholder="Type a message and press Enter" />
          <button id="sendMessageBtn" class="btn btn-primary"><i class="bi bi-send me-1"></i>Send</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Close main before footer so footer can be full-width -->
</main>

<footer class="bg-dark text-light mt-5 py-4">
  <div class="container">
    <div class="row align-items-center g-3">
      <div class="col-12 col-md-4 small d-flex align-items-center">
        <i class="bi bi-robot me-2"></i>
        <span><i class="bi bi-c-circle me-1"></i><span id="footerYear"></span> Azure AI Foundry TTS Avatar Demo</span>
      </div>
      <div class="col-12 col-md-4 text-md-center">
        <span class="small">
          <i class="bi bi-lightbulb me-1"></i>
          Thanks to
          <a class="link-light text-decoration-none ms-1" href="https://www.linkedin.com/in/ppiova/" target="_blank" rel="noopener">
            Pablo Piovano
          </a>
          for the original idea
        </span>
      </div>
      <div class="col-12 col-md-4 text-md-end small">
        <span class="me-2"><i class="bi bi-soundwave me-1"></i>Azure Speech</span>
        <span class="me-2">+</span>
        <span><i class="bi bi-cpu me-1"></i>Azure OpenAI</span>
  <a class="link-light text-decoration-none ms-3" href="https://github.com/ppiova" target="_blank" rel="noopener"><i class="bi bi-github me-1"></i>GitHub</a>
      </div>
    </div>
  </div>
</footer>

<script>
// Footer year
(function(){var y=new Date().getFullYear();var el=document.getElementById('footerYear');if(el)el.textContent=y;})();
// Initialize configuration when page loads
window.addEventListener('load', function() {
    // Load configuration automatically
    loadConfiguration();
});
</script>

</body>

</html>